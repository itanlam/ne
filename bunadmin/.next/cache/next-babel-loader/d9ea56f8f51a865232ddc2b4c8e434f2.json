{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/Volumes/Untitled/GitHub/itanlam/ne/bunadmin/src/layouts/DefaultLayout/TopBar/TopBarRightMenu/UserMenu.tsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from \"react\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport Menu from \"@material-ui/core/Menu\";\nimport EvaIcon from \"react-eva-icons\";\nimport { useTheme } from \"@material-ui/core/styles\";\nimport { Collection } from \"@/core/setting/collections\";\nimport rxDb from \"@/utils/database/rxConnect\";\nimport Divider from \"@material-ui/core/Divider\";\nimport { DynamicRoute, LocalDataRoute, UserRoute } from \"@/utils/routes\";\nimport { useRouter } from \"next/router\";\nimport rxSubscribe from \"@/utils/database/rxSubscribe\";\nimport { Primary } from \"@/core/auth/schema\";\nimport { Trans, useTranslation } from \"react-i18next\";\nexport default function UserMenu() {\n  _s();\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var theme = useTheme();\n  var router = useRouter();\n\n  var _React$useState = React.useState(null),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      anchorEl = _React$useState2[0],\n      setAnchorEl = _React$useState2[1];\n\n  var open = Boolean(anchorEl);\n\n  var _useState = useState({\n    username: \"Guest\"\n  }),\n      state = _useState[0],\n      setState = _useState[1];\n\n  useEffect(function () {\n    ;\n\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return rxSubscribe({\n                collection: Collection.name,\n                where: {\n                  name: Primary\n                },\n                callback: function callback(data) {\n                  return data && data[0] && setState(_objectSpread(_objectSpread({}, state), {}, {\n                    username: data[0][\"value\"]\n                  }));\n                }\n              });\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  }, []);\n\n  var handleMenu = function handleMenu(event) {\n    setAnchorEl(event.currentTarget);\n  };\n\n  var handleClose = function handleClose(_ref2) {\n    var route = _ref2.route;\n    setAnchorEl(null);\n    if (!route) return;\n    router.push(DynamicRoute, route).then(function (_r) {});\n  };\n\n  var handleLogout = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var collection, db;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              // update username in setting\n              collection = Collection.name;\n              _context2.next = 3;\n              return rxDb();\n\n            case 3:\n              db = _context2.sent;\n              _context2.next = 6;\n              return db[collection].upsert({\n                name: Primary,\n                value: undefined,\n                updated_at: Date.now()\n              });\n\n            case 6:\n              handleClose({});\n              location.reload();\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleLogout() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return (// User Icon\n    __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 5\n      }\n    }, __jsx(IconButton, {\n      \"aria-label\": \"account of current user\",\n      \"aria-controls\": \"menu-appbar\",\n      \"aria-haspopup\": \"true\",\n      onClick: handleMenu,\n      color: \"inherit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 7\n      }\n    }, __jsx(EvaIcon, {\n      name: \"person-outline\",\n      size: \"large\",\n      fill: theme.bunadmin.iconColor,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }\n    })), __jsx(Menu, {\n      id: \"menu-appbar\",\n      anchorEl: anchorEl,\n      anchorOrigin: {\n        vertical: \"top\",\n        horizontal: \"right\"\n      },\n      keepMounted: true,\n      transformOrigin: {\n        vertical: \"top\",\n        horizontal: \"right\"\n      },\n      open: open,\n      onClose: function onClose() {\n        return handleClose({});\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 7\n      }\n    }, __jsx(MenuItem, {\n      disabled: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }\n    }, __jsx(Trans, {\n      i18nKey: \"Signed as $username\",\n      values: {\n        name: state.username && state.username.substr(0, 20)\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 11\n      }\n    })), __jsx(MenuItem, {\n      onClick: function onClick() {\n        return handleClose({});\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }\n    }, t(\"Profile\")), __jsx(Divider, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }\n    }), __jsx(MenuItem, {\n      onClick: function onClick() {\n        return handleClose({\n          route: LocalDataRoute.auth\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }\n    }, t(\"Switch account\")), __jsx(MenuItem, {\n      onClick: function onClick() {\n        return handleClose({\n          route: UserRoute.signIn\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 9\n      }\n    }, t(\"Add another account\")), __jsx(Divider, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }\n    }), __jsx(MenuItem, {\n      onClick: handleLogout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 9\n      }\n    }, t(\"Logout\"))))\n  );\n}\n\n_s(UserMenu, \"XinRqDwZvSdlfBTGNG0JAf3AhV4=\", false, function () {\n  return [useTranslation, useTheme, useRouter];\n});\n\n_c = UserMenu;\n\nvar _c;\n\n$RefreshReg$(_c, \"UserMenu\");","map":{"version":3,"sources":["/Volumes/Untitled/GitHub/itanlam/ne/bunadmin/src/layouts/DefaultLayout/TopBar/TopBarRightMenu/UserMenu.tsx"],"names":["React","useEffect","useState","IconButton","MenuItem","Menu","EvaIcon","useTheme","Collection","rxDb","Divider","DynamicRoute","LocalDataRoute","UserRoute","useRouter","rxSubscribe","Primary","Trans","useTranslation","UserMenu","t","theme","router","anchorEl","setAnchorEl","open","Boolean","username","state","setState","collection","name","where","callback","data","handleMenu","event","currentTarget","handleClose","route","push","then","_r","handleLogout","db","upsert","value","undefined","updated_at","Date","now","location","reload","bunadmin","iconColor","vertical","horizontal","substr","auth","signIn"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\nimport IconButton from \"@material-ui/core/IconButton\"\nimport MenuItem from \"@material-ui/core/MenuItem\"\nimport Menu from \"@material-ui/core/Menu\"\nimport EvaIcon from \"react-eva-icons\"\nimport { useTheme } from \"@material-ui/core/styles\"\nimport { Collection } from \"@/core/setting/collections\"\nimport rxDb from \"@/utils/database/rxConnect\"\nimport Divider from \"@material-ui/core/Divider\"\nimport { DynamicRoute, LocalDataRoute, UserRoute } from \"@/utils/routes\"\nimport { useRouter } from \"next/router\"\nimport rxSubscribe from \"@/utils/database/rxSubscribe\"\nimport { Primary } from \"@/core/auth/schema\"\nimport { Trans, useTranslation } from \"react-i18next\"\n\ninterface State {\n  username: string | \"Guest\"\n}\n\nexport default function UserMenu() {\n  const { t } = useTranslation()\n  const theme = useTheme()\n  const router = useRouter()\n  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null)\n  const open = Boolean(anchorEl)\n  const [state, setState] = useState<State>({\n    username: \"Guest\"\n  })\n\n  useEffect(() => {\n    ;(async () => {\n      await rxSubscribe({\n        collection: Collection.name,\n        where: { name: Primary },\n        callback: data =>\n          data &&\n          data[0] &&\n          setState({\n            ...state,\n            username: data[0][\"value\"]\n          })\n      })\n    })()\n  }, [])\n\n  const handleMenu = (event: React.MouseEvent<HTMLElement>) => {\n    setAnchorEl(event.currentTarget)\n  }\n\n  const handleClose = ({ route }: { route?: string }) => {\n    setAnchorEl(null)\n    if (!route) return\n    router.push(DynamicRoute, route).then(_r => {})\n  }\n\n  const handleLogout = async () => {\n    // update username in setting\n    const collection = Collection.name\n    const db = await rxDb()\n\n    await db[collection].upsert({\n      name: Primary,\n      value: undefined,\n      updated_at: Date.now()\n    })\n\n    handleClose({})\n    location.reload()\n  }\n\n  return (\n    // User Icon\n    <div>\n      <IconButton\n        aria-label=\"account of current user\"\n        aria-controls=\"menu-appbar\"\n        aria-haspopup=\"true\"\n        onClick={handleMenu}\n        color=\"inherit\"\n      >\n        <EvaIcon\n          name=\"person-outline\"\n          size=\"large\"\n          fill={theme.bunadmin.iconColor}\n        />\n      </IconButton>\n      <Menu\n        id=\"menu-appbar\"\n        anchorEl={anchorEl}\n        anchorOrigin={{\n          vertical: \"top\",\n          horizontal: \"right\"\n        }}\n        keepMounted\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"right\"\n        }}\n        open={open}\n        onClose={() => handleClose({})}\n      >\n        <MenuItem disabled>\n          <Trans\n            i18nKey=\"Signed as $username\"\n            values={{ name: state.username && state.username.substr(0, 20) }}\n          />\n        </MenuItem>\n        <MenuItem onClick={() => handleClose({})}>{t(\"Profile\")}</MenuItem>\n        <Divider />\n        <MenuItem onClick={() => handleClose({ route: LocalDataRoute.auth })}>\n          {t(\"Switch account\")}\n        </MenuItem>\n        <MenuItem onClick={() => handleClose({ route: UserRoute.signIn })}>\n          {t(\"Add another account\")}\n        </MenuItem>\n        <Divider />\n        <MenuItem onClick={handleLogout}>{t(\"Logout\")}</MenuItem>\n      </Menu>\n    </div>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}