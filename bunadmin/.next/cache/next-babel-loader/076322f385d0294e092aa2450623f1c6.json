{"ast":null,"code":"var _jsxFileName = \"/Volumes/Untitled/GitHub/itanlam/ne/bunadmin/src/layouts/DefaultLayout/TopBar/TopBarRightMenu/UserMenu.tsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect, useState } from \"react\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport Menu from \"@material-ui/core/Menu\";\nimport EvaIcon from \"react-eva-icons\";\nimport { useTheme } from \"@material-ui/core/styles\";\nimport { Collection } from \"@/core/setting/collections\";\nimport rxDb from \"@/utils/database/rxConnect\";\nimport Divider from \"@material-ui/core/Divider\";\nimport { DynamicRoute, LocalDataRoute, UserRoute } from \"@/utils/routes\";\nimport { useRouter } from \"next/router\";\nimport rxSubscribe from \"@/utils/database/rxSubscribe\";\nimport { Primary } from \"@/core/auth/schema\";\nimport { Trans, useTranslation } from \"react-i18next\";\nexport default function UserMenu() {\n  const {\n    t\n  } = useTranslation();\n  const theme = useTheme();\n  const router = useRouter();\n  const [anchorEl, setAnchorEl] = React.useState(null);\n  const open = Boolean(anchorEl);\n  const {\n    0: state,\n    1: setState\n  } = useState({\n    username: \"Guest\"\n  });\n  useEffect(() => {\n    ;\n\n    (async () => {\n      await rxSubscribe({\n        collection: Collection.name,\n        where: {\n          name: Primary\n        },\n        callback: data => data && data[0] && setState(_objectSpread(_objectSpread({}, state), {}, {\n          username: data[0][\"value\"]\n        }))\n      });\n    })();\n  }, []);\n\n  const handleMenu = event => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = ({\n    route\n  }) => {\n    setAnchorEl(null);\n    if (!route) return;\n    router.push(DynamicRoute, route).then(_r => {});\n  };\n\n  const handleLogout = async () => {\n    // update username in setting\n    const collection = Collection.name;\n    const db = await rxDb();\n    await db[collection].upsert({\n      name: Primary,\n      value: undefined,\n      updated_at: Date.now()\n    });\n    handleClose({});\n    location.reload();\n  };\n\n  return (// User Icon\n    __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73,\n        columnNumber: 5\n      }\n    }, __jsx(IconButton, {\n      \"aria-label\": \"account of current user\",\n      \"aria-controls\": \"menu-appbar\",\n      \"aria-haspopup\": \"true\",\n      onClick: handleMenu,\n      color: \"inherit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 7\n      }\n    }, __jsx(EvaIcon, {\n      name: \"person-outline\",\n      size: \"large\",\n      fill: theme.bunadmin.iconColor,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }\n    })), __jsx(Menu, {\n      id: \"menu-appbar\",\n      anchorEl: anchorEl,\n      anchorOrigin: {\n        vertical: \"top\",\n        horizontal: \"right\"\n      },\n      keepMounted: true,\n      transformOrigin: {\n        vertical: \"top\",\n        horizontal: \"right\"\n      },\n      open: open,\n      onClose: () => handleClose({}),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 7\n      }\n    }, __jsx(MenuItem, {\n      disabled: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }\n    }, __jsx(Trans, {\n      i18nKey: \"Signed as $username\",\n      values: {\n        name: state.username && state.username.substr(0, 20)\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 11\n      }\n    })), __jsx(MenuItem, {\n      onClick: () => handleClose({}),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }\n    }, t(\"Profile\")), __jsx(Divider, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 9\n      }\n    }), __jsx(MenuItem, {\n      onClick: () => handleClose({\n        route: LocalDataRoute.auth\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }\n    }, t(\"Switch account\")), __jsx(MenuItem, {\n      onClick: () => handleClose({\n        route: UserRoute.signIn\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 9\n      }\n    }, t(\"Add another account\")), __jsx(Divider, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }\n    }), __jsx(MenuItem, {\n      onClick: handleLogout,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 9\n      }\n    }, t(\"Logout\"))))\n  );\n}","map":{"version":3,"sources":["/Volumes/Untitled/GitHub/itanlam/ne/bunadmin/src/layouts/DefaultLayout/TopBar/TopBarRightMenu/UserMenu.tsx"],"names":["React","useEffect","useState","IconButton","MenuItem","Menu","EvaIcon","useTheme","Collection","rxDb","Divider","DynamicRoute","LocalDataRoute","UserRoute","useRouter","rxSubscribe","Primary","Trans","useTranslation","UserMenu","t","theme","router","anchorEl","setAnchorEl","open","Boolean","state","setState","username","collection","name","where","callback","data","handleMenu","event","currentTarget","handleClose","route","push","then","_r","handleLogout","db","upsert","value","undefined","updated_at","Date","now","location","reload","bunadmin","iconColor","vertical","horizontal","substr","auth","signIn"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\nimport IconButton from \"@material-ui/core/IconButton\"\nimport MenuItem from \"@material-ui/core/MenuItem\"\nimport Menu from \"@material-ui/core/Menu\"\nimport EvaIcon from \"react-eva-icons\"\nimport { useTheme } from \"@material-ui/core/styles\"\nimport { Collection } from \"@/core/setting/collections\"\nimport rxDb from \"@/utils/database/rxConnect\"\nimport Divider from \"@material-ui/core/Divider\"\nimport { DynamicRoute, LocalDataRoute, UserRoute } from \"@/utils/routes\"\nimport { useRouter } from \"next/router\"\nimport rxSubscribe from \"@/utils/database/rxSubscribe\"\nimport { Primary } from \"@/core/auth/schema\"\nimport { Trans, useTranslation } from \"react-i18next\"\n\ninterface State {\n  username: string | \"Guest\"\n}\n\nexport default function UserMenu() {\n  const { t } = useTranslation()\n  const theme = useTheme()\n  const router = useRouter()\n  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null)\n  const open = Boolean(anchorEl)\n  const [state, setState] = useState<State>({\n    username: \"Guest\"\n  })\n\n  useEffect(() => {\n    ;(async () => {\n      await rxSubscribe({\n        collection: Collection.name,\n        where: { name: Primary },\n        callback: data =>\n          data &&\n          data[0] &&\n          setState({\n            ...state,\n            username: data[0][\"value\"]\n          })\n      })\n    })()\n  }, [])\n\n  const handleMenu = (event: React.MouseEvent<HTMLElement>) => {\n    setAnchorEl(event.currentTarget)\n  }\n\n  const handleClose = ({ route }: { route?: string }) => {\n    setAnchorEl(null)\n    if (!route) return\n    router.push(DynamicRoute, route).then(_r => {})\n  }\n\n  const handleLogout = async () => {\n    // update username in setting\n    const collection = Collection.name\n    const db = await rxDb()\n\n    await db[collection].upsert({\n      name: Primary,\n      value: undefined,\n      updated_at: Date.now()\n    })\n\n    handleClose({})\n    location.reload()\n  }\n\n  return (\n    // User Icon\n    <div>\n      <IconButton\n        aria-label=\"account of current user\"\n        aria-controls=\"menu-appbar\"\n        aria-haspopup=\"true\"\n        onClick={handleMenu}\n        color=\"inherit\"\n      >\n        <EvaIcon\n          name=\"person-outline\"\n          size=\"large\"\n          fill={theme.bunadmin.iconColor}\n        />\n      </IconButton>\n      <Menu\n        id=\"menu-appbar\"\n        anchorEl={anchorEl}\n        anchorOrigin={{\n          vertical: \"top\",\n          horizontal: \"right\"\n        }}\n        keepMounted\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"right\"\n        }}\n        open={open}\n        onClose={() => handleClose({})}\n      >\n        <MenuItem disabled>\n          <Trans\n            i18nKey=\"Signed as $username\"\n            values={{ name: state.username && state.username.substr(0, 20) }}\n          />\n        </MenuItem>\n        <MenuItem onClick={() => handleClose({})}>{t(\"Profile\")}</MenuItem>\n        <Divider />\n        <MenuItem onClick={() => handleClose({ route: LocalDataRoute.auth })}>\n          {t(\"Switch account\")}\n        </MenuItem>\n        <MenuItem onClick={() => handleClose({ route: UserRoute.signIn })}>\n          {t(\"Add another account\")}\n        </MenuItem>\n        <Divider />\n        <MenuItem onClick={handleLogout}>{t(\"Logout\")}</MenuItem>\n      </Menu>\n    </div>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}